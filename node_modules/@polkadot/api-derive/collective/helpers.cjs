"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.callMethod = callMethod;
exports.getInstance = getInstance;
exports.withSection = withSection;

var _rxjs = require("rxjs");

var _util = require("@polkadot/util");

var _index = require("../util/index.cjs");

// Copyright 2017-2021 @polkadot/api-derive authors & contributors
// SPDX-License-Identifier: Apache-2.0
function getInstance(api, section) {
  const instances = api.registry.getModuleInstances(api.runtimeVersion.specName.toString(), section);
  return instances && instances.length ? instances[0] : section;
}

function withSection(_section, fn) {
  return (instanceId, api) => (0, _index.memo)(instanceId, fn(getInstance(api, _section), api, instanceId));
}

function callMethod(method, empty) {
  return _section => withSection(_section, (section, api) => () => {
    var _api$query$section;

    return (0, _util.isFunction)((_api$query$section = api.query[section]) === null || _api$query$section === void 0 ? void 0 : _api$query$section[method]) ? api.query[section][method]() : (0, _rxjs.of)(empty);
  });
}