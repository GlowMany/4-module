{"version":3,"file":"model.js","sourceRoot":"","sources":["../../../../src/project/versioned/v0_0_1/model.ts"],"names":[],"mappings":";AAAA,gEAAgE;AAChE,sCAAsC;;;;;;;;;;;;AAGtC,yDAAuC;AACvC,qDAA8G;AAC9G,yCAA+D;AAE/D,kCAAgD;AAGhD,MAAa,oBAAqB,SAAQ,mBAAU;CAMnD;AAJC;IADC,IAAA,0BAAQ,GAAE;;sDACM;AAGjB;IAFC,IAAA,0BAAQ,GAAE;IACV,IAAA,4BAAU,GAAE;;wDACO;AALtB,oDAMC;AAED,MAAa,2BACX,SAAQ,8BAAwD;CAKjE;AADC;IADC,IAAA,0BAAQ,GAAE;;yDACE;AALf,kEAMC;AAED,MAAa,yBAA0B,SAAQ,8BAAuB;IAapE,YAAY;QACV,MAAM,IAAI,KAAK,CAAC,qFAAqF,CAAC,CAAC;IACzG,CAAC;IAED,QAAQ;QACN,MAAM,MAAM,GAAG,IAAA,8BAAY,EAAC,IAAI,EAAE,EAAC,SAAS,EAAE,IAAI,EAAE,oBAAoB,EAAE,IAAI,EAAC,CAAC,CAAC;QACjF,IAAI,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,MAAM,EAAE;YAClB,4BAA4B;YAC5B,MAAM,SAAS,GAAG,MAAM,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC7D,MAAM,IAAI,KAAK,CAAC,kCAAkC,SAAS,EAAE,CAAC,CAAC;SAChE;IACH,CAAC;CACF;AAvBC;IADC,IAAA,wBAAM,EAAC,OAAO,CAAC;;8DACI;AAIpB;IAHC,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,oBAAoB,CAAC;IAChC,IAAA,0BAAQ,GAAE;8BACF,oBAAoB;0DAAC;AAE9B;IADC,IAAA,0BAAQ,GAAE;;yDACI;AAIf;IAHC,IAAA,yBAAO,GAAE;IACT,IAAA,gCAAc,GAAE;IAChB,IAAA,wBAAI,EAAC,GAAG,EAAE,CAAC,2BAA2B,CAAC;;8DACD;AAZzC,8DAyBC","sourcesContent":["// Copyright 2020-2021 OnFinality Limited authors & contributors\n// SPDX-License-Identifier: Apache-2.0\n\nimport {SubqlMapping, SubqlRuntimeHandler} from '@subql/types';\nimport {Type} from 'class-transformer';\nimport {Equals, IsArray, IsObject, IsOptional, IsString, ValidateNested, validateSync} from 'class-validator';\nimport {RuntimeDataSourceBase, ChainTypes} from '../../models';\nimport {ProjectNetworkConfig} from '../../types';\nimport {ProjectManifestBaseImpl} from '../base';\nimport {ProjectManifestV0_0_1, RuntimeDataSourceV0_0_1} from './types';\n\nexport class ProjectNetworkV0_0_1 extends ChainTypes implements ProjectNetworkConfig {\n  @IsString()\n  endpoint: string;\n  @IsString()\n  @IsOptional()\n  dictionary?: string;\n}\n\nexport class RuntimeDataSourceV0_0_1Impl\n  extends RuntimeDataSourceBase<SubqlMapping<SubqlRuntimeHandler>>\n  implements RuntimeDataSourceV0_0_1\n{\n  @IsString()\n  name: string;\n}\n\nexport class ProjectManifestV0_0_1Impl extends ProjectManifestBaseImpl implements ProjectManifestV0_0_1 {\n  @Equals('0.0.1')\n  specVersion: string;\n  @ValidateNested()\n  @Type(() => ProjectNetworkV0_0_1)\n  @IsObject()\n  network: ProjectNetworkV0_0_1;\n  @IsString()\n  schema: string;\n  @IsArray()\n  @ValidateNested()\n  @Type(() => RuntimeDataSourceV0_0_1Impl)\n  dataSources: RuntimeDataSourceV0_0_1[];\n  toDeployment(): string {\n    throw new Error('Manifest spec 0.0.1 is not support for deployment, please migrate to 0.2.0 or above');\n  }\n\n  validate(): void {\n    const errors = validateSync(this, {whitelist: true, forbidNonWhitelisted: true});\n    if (errors?.length) {\n      // TODO: print error details\n      const errorMsgs = errors.map((e) => e.toString()).join('\\n');\n      throw new Error(`failed to parse project.yaml.\\n${errorMsgs}`);\n    }\n  }\n}\n"]}